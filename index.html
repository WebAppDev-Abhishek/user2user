<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Ephemeral Chat</title>
</head>
<body>

    <h1>Public Ephemeral Chat</h1>
    
    <!-- Chat Area -->
    <pre id="chat-box" style="height: 400px; width: 600px; border: 1px solid black; overflow-y: scroll; padding: 5px; white-space: pre-wrap;"></pre>

    <!-- Message Input -->
    <div>
        <input type="text" id="message-input" placeholder="Type a message..." style="width: 480px;">
        <button id="send-button">Send</button>
    </div>

    <script>
        // A simple, randomly generated user ID
        const userId = 'user_' + Math.random().toString(36).substring(2, 8);
        
        // Connect to a public WebSocket echo server
        const socket = new WebSocket('wss://echo.websocket.events');
        
        const chatBox = document.getElementById('chat-box');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        // Function to append a message to the chat box
        function appendMessage(sender, text) {
            const messageId = 'msg_' + Date.now() + Math.random().toString(36).substring(2, 6);
            
            const messageText = `[${new Date().toLocaleTimeString()}] ${sender}: ${text}\n`;
            
            const messageElement = document.createElement('div');
            messageElement.id = messageId;
            messageElement.textContent = messageText;
            
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;

            // Set a timer to remove the message after 60 seconds (60000 milliseconds)
            setTimeout(() => {
                const elementToRemove = document.getElementById(messageId);
                if (elementToRemove) {
                    elementToRemove.remove();
                }
            }, 60000);
        }

        // WebSocket Event Handlers
        socket.onopen = (event) => {
            appendMessage('System', `Connected. Your ID is ${userId}. Messages will disappear in 60 seconds.`);
        };

        socket.onmessage = (event) => {
            try {
                // Try to parse the message as JSON
                const message = JSON.parse(event.data);
                if (message.senderId && message.text) {
                    appendMessage(message.senderId, message.text);
                }
            } catch (error) {
                // If parsing fails, treat it as a simple text message
                appendMessage('Server', event.data);
            }
        };

        socket.onclose = (event) => {
            appendMessage('System', 'Disconnected. Refresh the page to reconnect.');
        };

        socket.onerror = (error) => {
            appendMessage('System', 'Connection error.');
        };

        // Send button and Enter key functionality
        function sendMessage() {
            if (socket.readyState === WebSocket.OPEN) {
                const message = messageInput.value.trim();
                if (message) {
                    const messageObject = {
                        senderId: userId,
                        text: message
                    };
                    socket.send(JSON.stringify(messageObject));
                    messageInput.value = '';
                }
            } else {
                appendMessage('System', 'Not connected to the server.');
            }
        }

        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>

</body>
</html>
